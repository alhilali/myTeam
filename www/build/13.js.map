{"version":3,"sources":["../../src/pages/post/post.module.ts","../../src/pages/post/post.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAyC;AACO;AACd;AACmC;AAcrE,IAAa,cAAc;IAA3B;IAA6B,CAAC;IAAD,qBAAC;AAAD,CAAC;AAAjB,cAAc;IAZ1B,uEAAQ,CAAC;QACR,YAAY,EAAE;YACZ,uDAAQ;SACT;QACD,OAAO,EAAE;YACP,uFAAgB;YAChB,sEAAe,CAAC,QAAQ,CAAC,uDAAQ,CAAC;SACnC;QACD,OAAO,EAAE;YACP,uDAAQ;SACT;KACF,CAAC;GACW,cAAc,CAAG;AAAH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjBkC;AAEnB;AAInB;AAC2B;AACE;AACgC;AACnD;AAEjC;;;;;GAKG;AASH,IAAa,QAAQ;IAKnB,kBAAmB,OAAsB,EAChC,SAAoB,EACnB,MAAgB,EAChB,MAAuB,EACvB,EAAuB,EACvB,eAAsC,EACtC,aAA4B,EAC5B,SAA0B,EAC1B,MAAc,EACd,KAAsB;QAThC,iBAcC;QAdkB,YAAO,GAAP,OAAO,CAAe;QAChC,cAAS,GAAT,SAAS,CAAW;QACnB,WAAM,GAAN,MAAM,CAAU;QAChB,WAAM,GAAN,MAAM,CAAiB;QACvB,OAAE,GAAF,EAAE,CAAqB;QACvB,oBAAe,GAAf,eAAe,CAAuB;QACtC,kBAAa,GAAb,aAAa,CAAe;QAC5B,cAAS,GAAT,SAAS,CAAiB;QAC1B,WAAM,GAAN,MAAM,CAAQ;QACd,UAAK,GAAL,KAAK,CAAiB;QAbhC,SAAI,GAAG,EAAU;QACjB,YAAO,GAAW,EAAE,CAAC;QAanB,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAC1C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,cAAI;YACtC,EAAE,CAAC,CAAC,IAAI,CAAC;gBAAC,KAAI,CAAC,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC;QAC1C,CAAC,CAAC;IACJ,CAAC;IAEK,iCAAc,GAApB;;;gBACM,GAAG;;;4BACP,qBAAM,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,cAAI;4BACrD,GAAG,GAAG,IAAI;4BACV,KAAI,CAAC,IAAI,GAAG,GAAG;4BACf,EAAE,CAAC,CAAC,CAAC,KAAI,CAAC,IAAI,CAAC,EAAE,CAAC;gCAAC,KAAI,CAAC,YAAY,EAAE,CAAC;wBACzC,CAAC,CAAC;;wBAJF,SAIE;wBACF,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,WAAW,EAAE;4BACvE,KAAK,EAAE;gCACL,YAAY,EAAE,WAAW;6BAC1B;yBACF,CAAC,CAAC;;;;;KACJ;IAED,+BAAY,GAAZ;QAAA,iBAeC;QAdC,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;YAChC,KAAK,EAAE,KAAK;YACZ,QAAQ,EAAE,yBAAyB;YACnC,OAAO,EAAE,CAAC;oBACR,IAAI,EAAE,OAAO;oBACb,OAAO,EAAE;wBACP,IAAI,QAAQ,CAAC;wBACb,EAAE,CAAC,CAAC,KAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;4BAAC,QAAQ,GAAG,KAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;wBACtE,IAAI;4BAAC,QAAQ,GAAG,UAAU,CAAC;wBAC3B,KAAI,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC;oBAChC,CAAC;iBACF,CAAC;SACH,CAAC,CAAC;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;IAClB,CAAC;IAED,8BAAW,GAAX;QAAA,iBAuBC;QAtBC,IAAM,IAAI,GAAG,2CAAU,EAAE,CAAC,MAAM,CAAC,qBAAqB,CAAC;QACvD,IAAM,UAAU,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,WAAW,CAAC,CAAC,IAAI,CAAC;YAC/E,EAAE,EAAE,IAAI,CAAC,aAAa;YACtB,OAAO,EAAE,IAAI,CAAC,OAAO;YACrB,IAAI,EAAE,IAAI;YACV,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE;SAChC,CAAC;QAEF,UAAU,CAAC,IAAI,CAAC;YACd,gBAAgB;YAChB,KAAI,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,GAAG,KAAI,CAAC,IAAI,CAAC,EAAE,GAAG,iBAAiB,GAAG,UAAU,CAAC,GAAG,CAAC;iBACzE,GAAG,CAAC;gBACH,MAAM,EAAE,KAAI,CAAC,aAAa;gBAC1B,OAAO,EAAE,KAAI,CAAC,OAAO;gBACrB,IAAI,EAAE,aAAa;gBACnB,MAAM,EAAE,KAAI,CAAC,IAAI,CAAC,IAAI;gBACtB,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE;gBAC/B,IAAI,EAAE,IAAI;aACX,CAAC;YAEJ,KAAI,CAAC,OAAO,GAAG,EAAE,CAAC;QACpB,CAAC,CAAC;IACJ,CAAC;IAED,gCAAa,GAAb,UAAc,OAAO;QACnB,sBAAsB;QACtB,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,iBAAiB,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE;QAEnF,iBAAiB;QACjB,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,YAAY,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,CAAC;IACtF,CAAC;IAED,6BAAU,GAAV,UAAW,GAAG;QAAd,iBAIC;QAHC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,cAAI;YACpC,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACtE,CAAC,CAAC;IACJ,CAAC;IAED,0BAAO,GAAP;QAAA,iBAgEC;QA/DC,IAAI,WAAW,CAAC;QAChB,IAAI,IAAI,CAAC;QACT,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;YACvC,IAAI,GAAG;gBACL;oBACE,IAAI,EAAE,QAAQ;oBACd,OAAO,EAAE;wBACP,KAAI,CAAC,aAAa,CAAC,KAAK,CAAC,KAAI,CAAC,IAAI,CAAC,IAAI,EAAE,KAAI,CAAC,IAAI,CAAC,KAAK,EACtD,oJAAoJ,EAAE,cAAc,CAAC;oBACzK,CAAC;iBACF;gBACD;oBACE,IAAI,EAAE,KAAK;oBACX,IAAI,EAAE,aAAa;oBACnB,OAAO,EAAE;wBACP,KAAI,CAAC,MAAM,CAAC,OAAO,CAAC,cAAc,EAAE,KAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBACpD,KAAI,CAAC,EAAE,CAAC,MAAM,CAAC,WAAW,GAAG,KAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,CAAC;wBAEtD,KAAI,CAAC,KAAK,CAAC,MAAM,CAAC;4BAChB,OAAO,EAAE,iBAAiB;4BAC1B,QAAQ,EAAE,IAAI;4BACd,QAAQ,EAAE,KAAK;4BACf,QAAQ,EAAE,SAAS;yBACpB,CAAC,CAAC,OAAO,EAAE,CAAC;wBAEb,KAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;oBACrB,CAAC;iBACF;gBACD;oBACE,IAAI,EAAE,OAAO;oBACb,IAAI,EAAE,QAAQ;oBACd,OAAO,EAAE;oBACT,CAAC;iBACF;aACF;QACH,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,GAAG;gBACL;oBACE,IAAI,EAAE,QAAQ;oBACd,OAAO,EAAE;wBACP,KAAI,CAAC,aAAa,CAAC,KAAK,CAAC,KAAI,CAAC,IAAI,CAAC,IAAI,EAAE,KAAI,CAAC,IAAI,CAAC,KAAK,EACtD,oJAAoJ,EAAE,cAAc,CAAC;oBACzK,CAAC;iBACF;gBACD;oBACE,IAAI,EAAE,QAAQ;oBACd,IAAI,EAAE,aAAa;oBACnB,OAAO,EAAE;wBACP,KAAI,CAAC,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,KAAI,CAAC,IAAI,CAAC;oBAC1C,CAAC;iBACF;gBACD;oBACE,IAAI,EAAE,OAAO;oBACb,IAAI,EAAE,QAAQ;oBACd,OAAO,EAAE;oBACT,CAAC;iBACF;aACF;QACH,CAAC;QACD,WAAW,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC;YACxC,OAAO,EAAE,IAAI;SACd,CAAC;QACF,WAAW,CAAC,OAAO,EAAE;IACvB,CAAC;IAEH,eAAC;AAAD,CAAC;AA7JY,QAAQ;IARpB,wEAAS,CAAC;QACT,OAAO,EAAE,UAAU;QACnB,cAAc,EAAE,CAAC,UAAU,EAAE,UAAU,CAAC;KACzC,CAAC;IACD,wEAAS,CAAC;QACT,QAAQ,EAAE,WAAW;OACG;KACzB,CAAC;aAegC;AA+IjC;SA7JY,QAAQ","file":"13.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { PostPage } from './post';\nimport { ComponentsModule } from '../../components/components.module'\n\n@NgModule({\n  declarations: [\n    PostPage,\n  ],\n  imports: [\n    ComponentsModule,\n    IonicPageModule.forChild(PostPage),\n  ],\n  exports: [\n    PostPage\n  ]\n})\nexport class PostPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/post/post.module.ts","import { SocialSharing } from \"@ionic-native/social-sharing\";\nimport { Post } from \"./../../models/post\";\nimport { Component } from '@angular/core';\nimport {\n  IonicPage, NavController, NavParams, ToastController,\n  ActionSheetController, AlertController, Events\n} from 'ionic-angular';\nimport { MyTeamDB } from '../../helpers/myTeamDB';\nimport { AngularFireAuth } from 'angularfire2/auth';\nimport { AngularFireDatabase, FirebaseListObservable } from 'angularfire2/database';\nimport * as moment from 'moment';\n\n/**\n * Generated class for the PostPage page.\n *\n * See http://ionicframework.com/docs/components/#navigation for more info\n * on Ionic pages and navigation.\n */\n@IonicPage({\n  segment: 'post/:id',\n  defaultHistory: ['PostPage', 'HomePage']\n})\n@Component({\n  selector: 'page-post',\n  templateUrl: 'post.html',\n})\nexport class PostPage {\n  post = {} as Post\n  comment: string = '';\n  comments: FirebaseListObservable<any[]>;\n  currentUserID: any\n  constructor(public navCtrl: NavController,\n    public navParams: NavParams,\n    private teamDB: MyTeamDB,\n    private afAuth: AngularFireAuth,\n    private db: AngularFireDatabase,\n    private actionSheetCtrl: ActionSheetController,\n    private socialSharing: SocialSharing,\n    private alertCtrl: AlertController,\n    private events: Events,\n    private toast: ToastController) {\n    this.post.$key = this.navParams.get('id');\n    this.afAuth.auth.onAuthStateChanged(user => {\n      if (user) this.currentUserID = user.uid;\n    })\n  }\n\n  async ionViewDidLoad() {\n    let res;\n    await this.teamDB.getPostInfo(this.post.$key).then(data => {\n      res = data\n      this.post = res\n      if (!this.post.by) this.postNotFound();\n    })\n    this.comments = this.db.list('timeline/' + this.post.$key + '/comments', {\n      query: {\n        orderByChild: 'timestamp'\n      }\n    });\n  }\n\n  postNotFound() {\n    let alert = this.alertCtrl.create({\n      title: 'خطأ',\n      subTitle: 'يبدو ان المشاركة محذوفة',\n      buttons: [{\n        text: 'حسناً',\n        handler: () => {\n          let redirect;\n          if (this.navCtrl.getPrevious()) redirect = this.navCtrl.getPrevious();\n          else redirect = 'HomePage';\n          this.navCtrl.setRoot(redirect)\n        }\n      }]\n    });\n    alert.present();\n  }\n\n  sendComment() {\n    const date = moment.utc().format('YYYY-MM-DD HH:mm:ss')\n    const commentKey = this.db.list('timeline/' + this.post.$key + '/comments').push({\n      by: this.currentUserID,\n      message: this.comment,\n      date: date,\n      timestamp: new Date().getTime()\n    })\n\n    commentKey.then(() => {\n      // Notify author\n      this.db.object('users/' + this.post.by + '/notifications/' + commentKey.key)\n        .set({\n          player: this.currentUserID,\n          message: this.comment,\n          type: 'postComment',\n          postID: this.post.$key,\n          timestamp: new Date().getTime(),\n          date: date\n        })\n\n      this.comment = '';\n    })\n  }\n\n  deleteComment(comment) {\n    // Remove notigication\n    this.db.object('users/' + this.post.by + '/notifications/' + comment.$key).remove()\n\n    // Remove comment\n    this.db.object('timeline/' + this.post.$key + '/comments/' + comment.$key).remove();\n  }\n\n  openPlayer(uid) {\n    this.teamDB.getUserInfo(uid).then(data => {\n      this.navCtrl.push('PlayerPage', { username: data.originalUsername })\n    })\n  }\n\n  options() {\n    let actionSheet;\n    let btns;\n    if (this.post.by == this.currentUserID) {\n      btns = [\n        {\n          text: 'مشاركة',\n          handler: () => {\n            this.socialSharing.share(this.post.info, this.post.title,\n              \"https://firebasestorage.googleapis.com/v0/b/myteam-29a5b.appspot.com/o/1500455988652%2Fbg.jpg?alt=media&token=88cee9ee-6b3e-4942-a756-99242b5fcbac\", \"felmel3ab://\")\n          }\n        },\n        {\n          text: 'حذف',\n          role: 'destructive',\n          handler: () => {\n            this.events.publish('post:deleted', this.post.$key);\n            this.db.object('timeline/' + this.post.$key).remove();\n\n            this.toast.create({\n              message: 'تم حذف المشاركة',\n              duration: 2200,\n              position: 'top',\n              cssClass: 'failure'\n            }).present();\n\n            this.navCtrl.pop();\n          }\n        },\n        {\n          text: 'إلغاء',\n          role: 'cancel',\n          handler: () => {\n          }\n        }\n      ]\n    } else {\n      btns = [\n        {\n          text: 'مشاركة',\n          handler: () => {\n            this.socialSharing.share(this.post.info, this.post.title,\n              \"https://firebasestorage.googleapis.com/v0/b/myteam-29a5b.appspot.com/o/1500455988652%2Fbg.jpg?alt=media&token=88cee9ee-6b3e-4942-a756-99242b5fcbac\", \"felmel3ab://\")\n          }\n        },\n        {\n          text: 'Report',\n          role: 'destructive',\n          handler: () => {\n            this.db.list('reports/').push(this.post)\n          }\n        },\n        {\n          text: 'إلغاء',\n          role: 'cancel',\n          handler: () => {\n          }\n        }\n      ]\n    }\n    actionSheet = this.actionSheetCtrl.create({\n      buttons: btns\n    })\n    actionSheet.present()\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/post/post.ts"],"sourceRoot":""}