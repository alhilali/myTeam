{"version":3,"sources":["../../src/pages/message/message.module.ts","../../src/directives/directives.module.ts","../../src/directives/flexible-keyboard/flexible-keyboard.ts","../../src/pages/message/message.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAwE;AAC/B;AACO;AACR;AAC6B;AAYrE,IAAa,iBAAiB;IAA9B;IAAiC,CAAC;IAAD,wBAAC;AAAD,CAAC;AAArB,iBAAiB;IAV7B,uEAAQ,CAAC;QACR,YAAY,EAAE;YACZ,6DAAW;SACZ;QACD,OAAO,EAAE;YACP,uFAAgB;YAChB,uFAAgB;YAChB,sEAAe,CAAC,QAAQ,CAAC,6DAAW,CAAC;SACtC;KACF,CAAC;GACW,iBAAiB,CAAI;AAAJ;;;;;;;;;;;;;;;;;;AChBW;AACyC;AAMlF,IAAa,gBAAgB;IAA7B;IAA+B,CAAC;IAAD,uBAAC;AAAD,CAAC;AAAnB,gBAAgB;IAL5B,uEAAQ,CAAC;QACT,YAAY,EAAE,CAAC,uGAAyB,CAAC;QACzC,OAAO,EAAE,EAAE;QACX,OAAO,EAAE,CAAC,uGAAyB,CAAC;KACpC,CAAC;GACW,gBAAgB,CAAG;AAAH;;;;;;;;;;;;;;;;;;;;;;ACPqB;AACA;AAC4B;AAE9E;;;;;GAKG;AAOH,IAAa,yBAAyB;IAYpC,mCAAmB,OAAmB,EAAS,QAAkB,EACxD,QAAkB,EAAS,QAAkB;QADnC,YAAO,GAAP,OAAO,CAAY;QAAS,aAAQ,GAAR,QAAQ,CAAU;QACxD,aAAQ,GAAR,QAAQ,CAAU;QAAS,aAAQ,GAAR,QAAQ,CAAU;QAN9C,WAAM,GAAG,GAAG,CAAC;QACb,kBAAa,GAAG,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;IAMzC,CAAC;IAGD,mDAAe,GAAf;QACE,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAC5B,IAAI,CAAC,oBAAoB,EAAE;QAC7B,CAAC;QAED,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,CAAC;QAE7D,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC,oBAAoB,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;QACpE,IAAI,CAAC,YAAY,GAAG,QAAQ,CAAC,sBAAsB,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;QAGnE,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,GAAG,kBAAkB,GAAG,IAAI,CAAC,MAAM,GAAG,8BAA8B;YACrI,IAAI,CAAC,MAAM,GAAG,yFAAyF;QAEzG,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,OAAO,GAAG,kBAAkB,GAAG,IAAI,CAAC,MAAM,GAAG,8BAA8B;YACrJ,IAAI,CAAC,MAAM,GAAG,yFAAyF;QAEzG,IAAI,CAAC,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC;QAC/E,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,cAAc,CAAC;QAGjD,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,GAAG,CAAC;IAChC,CAAC;IAED,wDAAoB,GAApB;QAAA,iBAiBC;QAfC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC,SAAS,CAAC;YAC9D,IAAI,SAAS,GAAG,KAAI,CAAC,cAAc,GAAG,KAAI,CAAC,qBAAqB,GAAG,EAAE,CAAC;YACtE,IAAI,YAAY,GAAG,SAAS,GAAG,IAAI,CAAC;YACpC,KAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,KAAI,CAAC,qBAAqB,EAAE,cAAc,EAAE,YAAY,CAAC,CAAC;YACxF,KAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,KAAI,CAAC,aAAa,EAAE,cAAc,EAAE,KAAK,CAAC;QAC1E,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC,SAAS,CAAC,UAAC,CAAC;YAEhE,IAAI,SAAS,GAAG,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,GAAG,KAAI,CAAC,cAAc,GAAG,KAAI,CAAC,qBAAqB,CAAC;YACzF,IAAI,YAAY,GAAG,SAAS,GAAG,EAAE,GAAG,IAAI,CAAC;YACzC,KAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,KAAI,CAAC,qBAAqB,EAAE,cAAc,EAAE,YAAY,CAAC,CAAC;YACxF,KAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,KAAI,CAAC,aAAa,EAAE,cAAc,EAAE,CAAC,CAAC,gBAAgB,CAAC,GAAG,IAAI,CAAC,CAAC;YAC9F,KAAI,CAAC,YAAY,CAAC,eAAe,EAAE,KAAI,CAAC,aAAa,CAAC,CAAC;QACzD,CAAC,CAAC,CAAC;IACL,CAAC;IAED,oDAAgB,GAAhB,UAAiB,KAAK;QACpB,qEAAqE;QACrE,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;IAC3B,CAAC;IAED,gDAAY,GAAZ,UAAa,IAAI,EAAE,OAAO;QAA1B,iBAIC;QAHC,UAAU,CAAC;YACT,KAAI,CAAC,OAAO,CAAC,cAAc,EAAE,CAAC;QAChC,CAAC,EAAE,OAAO,CAAC,CAAC;IACd,CAAC;IACH,gCAAC;AAAD,CAAC;AArE0B;IAAxB,2EAAY,CAAC,SAAS,CAAC;8BAAU,8DAAO;0DAAC;AAD/B,yBAAyB;IANrC,wEAAS,CAAC;QACT,QAAQ,EAAE,qBAAqB;QAC/B,IAAI,EAAE;YACJ,OAAO,EAAE,0BAA0B;SACpC;KACF,CAAC;qCAa4B,iEAAU,EAAmB,gEAAQ;QAC9C,+DAAQ,EAAmB,wEAAQ;GAb3C,yBAAyB,CAsErC;AAtEqC;;;;;;;;;;;;;;;;;;;;;;;;;AChBY;AACkB;AAC0C;AAC1D;AACC;AACwB;AAE7E;;;;;GAKG;AAOH,IAAa,WAAW;IAStB,qBAAmB,OAAsB,EAChC,SAAoB,EACpB,QAAkB,EAClB,EAAuB,EACvB,MAAuB,EACvB,UAA2B;QALjB,YAAO,GAAP,OAAO,CAAe;QAChC,cAAS,GAAT,SAAS,CAAW;QACpB,aAAQ,GAAR,QAAQ,CAAU;QAClB,OAAE,GAAF,EAAE,CAAqB;QACvB,WAAM,GAAN,MAAM,CAAiB;QACvB,eAAU,GAAV,UAAU,CAAiB;QAPpC,eAAU,GAAW,EAAE;QAQrB,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACpC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YAClB,IAAI,CAAC,QAAQ,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC;YAC7C,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QACpC,CAAC;IACH,CAAC;IAED,oCAAc,GAAd;QACE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC;QACnD,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU;YACxD,YAAY,GAAG,IAAI,CAAC,KAAK,EAAE;YACzB,KAAK,EAAE;gBACL,YAAY,EAAE,WAAW;aAC1B;SACF,CAAC;QACJ,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK;YACvD,YAAY,GAAG,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC;QAC3C,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IAED,yCAAmB,GAAnB;QAAA,iBAaC;QAZC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU;YAC3D,YAAY,GAAG,IAAI,CAAC,KAAK,EAAE;YACzB,KAAK,EAAE;gBACL,YAAY,EAAE,WAAW;aAC1B;SACF,CAAC,CAAC,SAAS,CAAC,cAAI;YACf,IAAI,CAAC,OAAO,CAAC,aAAG;gBACd,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,IAAI,GAAG,CAAC,MAAM,IAAI,KAAI,CAAC,UAAU,CAAC,CAAC,CAAC;oBAChD,KAAI,CAAC,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,EAAE,KAAI,CAAC,KAAK,CAAC,CAAC;gBACpD,CAAC;YACH,CAAC,CAAC,CAAC;QACL,CAAC,CAAC;IACN,CAAC;IAED,sCAAgB,GAAhB;QACE,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACrC,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE,CAAC;IACpC,CAAC;IAED,iCAAW,GAAX;QAAA,iBAOC;QANC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,KAAK,EAAE,CAAC,CAAC,CAAC;YAC3B,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC;gBAC5D,KAAI,CAAC,OAAO,CAAC,cAAc,EAAE,CAAC;gBAC9B,KAAI,CAAC,UAAU,GAAG,EAAE;YACtB,CAAC,CAAC;QACJ,CAAC;IACH,CAAC;IAED,8BAAQ,GAAR;QACE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC;IACrD,CAAC;IAED,sCAAgB,GAAhB,UAAiB,KAAK;QACpB,EAAE,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,KAAK,UAAU,CAAC,CAAC,CAAC;YAC1C,KAAK,CAAC,cAAc,EAAE,CAAC;QACzB,CAAC;IACH,CAAC;IAED,qCAAe,GAAf,UAAgB,KAAY;QAC1B,KAAK,CAAC,cAAc,EAAE,CAAC;QACvB,IAAI,CAAC,WAAW,EAAE,CAAC;IACrB,CAAC;IAEH,kBAAC;AAAD,CAAC;AA9EuB;IAArB,0EAAS,CAAC,SAAS,CAAC;8BAAU,8DAAO;4CAAC;AAD5B,WAAW;IALvB,wEAAS,EAAE;IACX,wEAAS,CAAC;QACT,QAAQ,EAAE,cAAc;OACG;KAC5B,CAAC;yEAUyC;QACrB,yEAAS;QACV,kFAAQ;QACd,2EAAmB;QACf,mFAAe;QACX,QAAe;AAiErC;SA/EY,WAAW,e","file":"5.js","sourcesContent":["import { DirectivesModule } from \"./../../directives/directives.module\";\nimport { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { MessagePage } from './message';\nimport { ComponentsModule } from '../../components/components.module'\n\n@NgModule({\n  declarations: [\n    MessagePage,\n  ],\n  imports: [\n    ComponentsModule,\n    DirectivesModule,\n    IonicPageModule.forChild(MessagePage),\n  ],\n})\nexport class MessagePageModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/message/message.module.ts","import { NgModule } from '@angular/core';\nimport { FlexibleKeyboardDirective } from './flexible-keyboard/flexible-keyboard';\n@NgModule({\n\tdeclarations: [FlexibleKeyboardDirective],\n\timports: [],\n\texports: [FlexibleKeyboardDirective]\n})\nexport class DirectivesModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/directives/directives.module.ts","import { Keyboard } from \"@ionic-native/keyboard\";\nimport { Platform, Content } from \"ionic-angular\";\nimport { Directive, ElementRef, Renderer, ContentChild } from '@angular/core';\n\n/**\n * Generated class for the FlexibleKeyboardDirective directive.\n *\n * See https://angular.io/docs/ts/latest/api/core/index/DirectiveMetadata-class.html\n * for more info on Angular Directives.\n */\n@Directive({\n  selector: '[flexible-keyboard]', // Attribute selector\n  host: {\n    '(tab)': 'contentMouseDown($event)'\n  }\n})\nexport class FlexibleKeyboardDirective {\n  @ContentChild('content') content: Content;\n  inputElement;\n  textareaHeight;\n  scrollContentElelment: any;\n  private footerElement: any;\n  private initialTextAreaHeight;\n  private millis = 200;\n  private scrollTimeout = this.millis + 50;\n  private keyboardHideSub;\n  private keybaordShowSub;\n\n  constructor(public element: ElementRef, public renderer: Renderer,\n    public platform: Platform, public keyboard: Keyboard) {\n  }\n\n\n  ngAfterViewInit() {\n    if (this.platform.is('ios')) {\n      this.addKeyboardListeners()\n    }\n\n    this.scrollContentElelment = this.content.getScrollElement();\n\n    this.footerElement = document.getElementsByTagName('ion-footer')[0];\n    this.inputElement = document.getElementsByClassName('textarea')[0];\n\n\n    this.footerElement.style.cssText = this.footerElement.style.cssText + \"transition: all \" + this.millis + \"ms; -webkit-transition: all \" +\n      this.millis + \"ms; -webkit-transition-timing-function: ease-out; transition-timing-function: ease-out;\"\n\n    this.scrollContentElelment.style.cssText = this.scrollContentElelment.style.cssText + \"transition: all \" + this.millis + \"ms; -webkit-transition: all \" +\n      this.millis + \"ms; -webkit-transition-timing-function: ease-out; transition-timing-function: ease-out;\"\n\n    this.textareaHeight = Number(this.inputElement.style.height.replace('px', ''));\n    this.initialTextAreaHeight = this.textareaHeight;\n\n\n    this.updateScroll('load', 500)\n  }\n\n  addKeyboardListeners() {\n\n    this.keyboardHideSub = this.keyboard.onKeyboardHide().subscribe(() => {\n      let newHeight = this.textareaHeight - this.initialTextAreaHeight + 28;\n      let marginBottom = newHeight + 'px';\n      this.renderer.setElementStyle(this.scrollContentElelment, 'marginBottom', marginBottom);\n      this.renderer.setElementStyle(this.footerElement, 'marginBottom', '0px')\n    });\n\n    this.keybaordShowSub = this.keyboard.onKeyboardShow().subscribe((e) => {\n\n      let newHeight = (e['keyboardHeight']) + this.textareaHeight - this.initialTextAreaHeight;\n      let marginBottom = newHeight + 28 + 'px';\n      this.renderer.setElementStyle(this.scrollContentElelment, 'marginBottom', marginBottom);\n      this.renderer.setElementStyle(this.footerElement, 'marginBottom', e['keyboardHeight'] + 'px');\n      this.updateScroll('keybaord show', this.scrollTimeout);\n    });\n  }\n\n  contentMouseDown(event) {\n    //console.log('blurring input element :- > event type:', event.type);\n    this.inputElement.blur();\n  }\n\n  updateScroll(from, timeout) {\n    setTimeout(() => {\n      this.content.scrollToBottom();\n    }, timeout);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/directives/flexible-keyboard/flexible-keyboard.ts","import { Keyboard } from \"@ionic-native/keyboard\";\nimport { MessageProvider } from \"./../../providers/message/message\";\nimport { AngularFireDatabase, FirebaseListObservable, FirebaseObjectObservable } from \"angularfire2/database\";\nimport { AngularFireAuth } from \"angularfire2/auth\";\nimport { Component, ViewChild } from \"@angular/core\";\nimport { IonicPage, NavController, NavParams, Content } from \"ionic-angular\";\n\n/**\n * Generated class for the MessagePage page.\n *\n * See http://ionicframework.com/docs/components/#navigation for more info\n * on Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-message',\n  templateUrl: 'message.html',\n})\nexport class MessagePage {\n  @ViewChild('content') content: Content;\n  allMessages: FirebaseListObservable<any[]>\n  messageStatus: FirebaseObjectObservable<any>\n  allMessagesSub: any;\n  toUID: any\n  currentUID: any\n  newMessage: string = ''\n\n  constructor(public navCtrl: NavController,\n    public navParams: NavParams,\n    public keyboard: Keyboard,\n    public db: AngularFireDatabase,\n    public afAuth: AngularFireAuth,\n    public msgService: MessageProvider) {\n    this.toUID = navParams.get('toUID');\n    if (this.keyboard) {\n      this.keyboard.hideKeyboardAccessoryBar(true);\n      this.keyboard.disableScroll(true);\n    }\n  }\n\n  ionViewDidLoad() {\n    this.currentUID = this.afAuth.auth.currentUser.uid;\n    this.allMessages = this.db.list('users/' + this.currentUID +\n      '/messages/' + this.toUID, {\n        query: {\n          orderByChild: 'timestamp'\n        }\n      })\n    this.messageStatus = this.db.object('users/' + this.toUID +\n      '/messages/' + this.currentUID + '/read')\n    this.markAllMessagesRead();\n  }\n\n  markAllMessagesRead() {\n    this.allMessagesSub = this.db.list('users/' + this.currentUID +\n      '/messages/' + this.toUID, {\n        query: {\n          orderByChild: 'timestamp'\n        }\n      }).subscribe(data => {\n        data.forEach(msg => {\n          if (msg.sentBy && msg.sentBy != this.currentUID) {\n            this.msgService.markMsgRead(msg.$key, this.toUID);\n          }\n        });\n      })\n  }\n\n  ionViewWillLeave() {\n    this.msgService.markRead(this.toUID);\n    this.allMessagesSub.unsubscribe();\n  }\n\n  sendMessage() {\n    if (this.newMessage !== '') {\n      this.msgService.sendMessage(this.newMessage, this.toUID).then(() => {\n        this.content.scrollToBottom();\n        this.newMessage = ''\n      })\n    }\n  }\n\n  openUser() {\n    this.navCtrl.push('PlayerPage', { id: this.toUID })\n  }\n\n  footerTouchStart(event) {\n    if (event.target.localName !== \"textarea\") {\n      event.preventDefault();\n    }\n  }\n\n  touchSendButton(event: Event) {\n    event.preventDefault();\n    this.sendMessage();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/message/message.ts"],"sourceRoot":""}