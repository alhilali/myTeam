{"version":3,"sources":["../../src/pages/notification/notification.module.ts","../../src/pages/notification/notification.ts"],"names":[],"mappings":"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","file":"12.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { NotificationPage } from './notification';\nimport { ComponentsModule } from '../../components/components.module'\n\n@NgModule({\n  declarations: [\n    NotificationPage,\n  ],\n  imports: [\n    ComponentsModule,\n    IonicPageModule.forChild(NotificationPage),\n  ],\n  exports: [\n    NotificationPage\n  ]\n})\nexport class NotificationPageModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/notification/notification.module.ts","import { MyTeamDB } from \"./../../helpers/myTeamDB\";\nimport { User } from \"./../../models/user\";\nimport { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ModalController } from 'ionic-angular';\nimport { AngularFireDatabase, FirebaseListObservable } from 'angularfire2/database';\nimport { AngularFireAuth } from 'angularfire2/auth';\nimport { Events } from 'ionic-angular';\nimport * as moment from 'moment';\n\n/**\n * Generated class for the NotificationPage page.\n *\n * See http://ionicframework.com/docs/components/#navigation for more info\n * on Ionic pages and navigation.\n */\n@IonicPage()\n@Component({\n  selector: 'page-notification',\n  templateUrl: 'notification.html',\n})\nexport class NotificationPage {\n\n  teamsRequest: any[] = []\n  requestsSub: any\n  matchRequests: any[] = []\n  userNotification: FirebaseListObservable<any[]>;\n  matchSub: any\n  currentUserUid: any\n\n  constructor(public navCtrl: NavController,\n    public navParams: NavParams,\n    private db: AngularFireDatabase,\n    private afAuth: AngularFireAuth,\n    public events: Events,\n    private modlCtrl: ModalController,\n    private teamDB: MyTeamDB) {\n  }\n\n  async ionViewWillEnter() {\n    await this.teamDB.getLoggedInUser().then(data => {\n      this.currentUserUid = data;\n    })\n    this.loadTeamRequests();\n    this.loadMatchRequests();\n    this.loadUserNotifications();\n  }\n\n  loadTeamRequests() {\n    if (this.requestsSub) this.requestsSub.unsubscribe();\n    const ref = this.db.list('users/' + this.currentUserUid\n      + '/requests')\n    this.requestsSub = ref.subscribe(data => {\n      this.teamsRequest = []\n      this.events.publish(\"tabs-page:badge-update\", 'user');\n      data.forEach(team => {\n        this.db.object('teams/' + team.teamId).take(1).subscribe(teamInfo => {\n          this.teamsRequest.push({ teamInfo: teamInfo, dateRequested: team.dateRequested })\n        })\n      })\n    })\n  }\n\n  loadMatchRequests() {\n    if (this.matchSub) this.matchSub.unsubscribe();\n    const ref = this.db.list('matches/', {\n      query: {\n        orderByChild: 'toUID',\n        equalTo: this.currentUserUid\n      }\n    })\n    this.matchSub = ref.subscribe(data => {\n      this.events.publish(\"tabs-page:badge-update\", 'match');\n      this.matchRequests = []\n      data.forEach(request => {\n        if (request.status == 'pending') {\n          this.db.object('teams/' + request.homeTeam).take(1).subscribe(teamInfo => {\n            this.matchRequests.push({ teamInfo: teamInfo, request: request })\n          })\n        }\n      })\n    })\n  }\n\n  loadUserNotifications() {\n    this.userNotification = this.db.list('users/' + this.currentUserUid + '/notifications/', {\n      query: {\n        orderByChild: 'timestamp'\n      }\n    });\n  }\n\n  doRefresh(refresher) {\n    this.loadTeamRequests();\n    this.loadMatchRequests();\n    this.loadUserNotifications();\n    setTimeout(() => {\n      refresher.complete();\n    }, 1000);\n  }\n\n  acceptTeam(team) {\n\n    // Add player to players list DB\n    const playersList = this.db.object('/playersList/' + team.$key + '/' + this.currentUserUid);\n    playersList.set({ uid: this.currentUserUid, status: 'enrolled' });\n\n    // Add team to user list DB\n    this.db.object('/users/' + this.currentUserUid + '/myTeams/' + team.$key)\n      .update({ teamId: team.$key });\n\n    // Remove request from user list DB\n    this.db.object('users/' + this.currentUserUid + '/requests/' + team.$key).remove();\n\n    // Add notification to current User\n    this.db.list('users/' + this.currentUserUid + '/notifications/').push({\n      type: 'joinedTeam',\n      by: team.$key,\n      timestamps: new Date().getTime(),\n      date: moment.utc().format('YYYY-MM-DD HH:mm:ss')\n    })\n  }\n\n  declineTeam(team) {\n    // Remove request from user list DB\n    this.db.object('users/' + this.currentUserUid + '/requests/' + team.$key).remove();\n\n    // Remove player from players list DB\n    this.db.object('/playersList/' + team.$key + '/' + this.currentUserUid).remove();\n  }\n\n  openTeam(teamID) {\n    this.navCtrl.push('TeamPage', { id: teamID })\n  }\n\n  openMatchRequest(request) {\n    this.navCtrl.push('MatchPage', { request: request })\n  }\n\n  ionViewWillLeave() {\n    this.requestsSub.unsubscribe();\n    this.matchSub.unsubscribe();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/notification/notification.ts"],"sourceRoot":""}